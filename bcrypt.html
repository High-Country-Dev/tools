<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bcrypt Generator</title>
    <style>
      * {
        box-sizing: border-box;
      }
      :root {
        --bg: #0e0f11;
        --panel: #16181c;
        --ink: #e9ecf1;
        --muted: #9aa5b1;
        --accent: #4cc9f0;
        --ok: #22c55e;
        --warn: #f59e0b;
        --radius: 14px;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
          Helvetica, Arial, "Segoe UI", Roboto, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        background: linear-gradient(180deg, #0b0c0e, var(--bg));
        color: var(--ink);
        display: grid;
        place-items: center;
        padding: 24px;
      }
      .container {
        width: 100%;
        max-width: 900px;
        background: var(--panel);
        border: 1px solid #23262d;
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }
      h1 {
        margin: 0 0 6px;
        font-size: 22px;
        font-weight: 700;
      }
      p.sub {
        margin: 0 0 14px;
        color: var(--muted);
        font-size: 14px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 820px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .card {
        background: #111317;
        border: 1px solid #22252c;
        border-radius: 12px;
        padding: 14px;
      }
      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input,
      select,
      textarea,
      button {
        width: 100%;
        font-size: 16px;
        font-family: Helvetica, Arial, sans-serif;
      }
      input[type="text"],
      input[type="number"],
      textarea,
      select {
        background: #0f1115;
        color: var(--ink);
        border: 1px solid #2a2e36;
        border-radius: 10px;
        padding: 10px 12px;
        outline: none;
      }
      input[type="text"]:focus,
      input[type="number"]:focus,
      textarea:focus,
      select:focus {
        border-color: var(--accent);
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      button {
        background: linear-gradient(180deg, #1c2027, #15181d);
        color: var(--ink);
        border: 1px solid #262a32;
        border-radius: 10px;
        padding: 10px 12px;
        cursor: pointer;
      }
      button:hover {
        border-color: var(--accent);
      }
      button.primary {
        background: linear-gradient(180deg, #2a7bb6, #1a5d8a);
        border-color: #1a5d8a;
      }
      .badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid #2b3038;
        color: var(--muted);
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }
      .code {
        font-variant-numeric: tabular-nums;
        letter-spacing: 0.02em;
        /* Allow very long strings (bcrypt salts/hashes) to wrap */
        overflow-wrap: anywhere;
        word-break: break-word;
      }
      .kv {
        display: grid;
        gap: 8px;
      }
      .kv-row {
        display: grid;
        grid-template-columns: 110px minmax(0, 1fr) auto;
        gap: 8px 10px;
        align-items: center;
      }
      .kv-row .code {
        min-width: 0;
      }
      .helper {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }
      hr {
        border: none;
        border-top: 1px solid #242831;
        margin: 12px 0;
      }
      .ok {
        color: var(--ok);
      }
      .warn {
        color: var(--warn);
      }
      .inline {
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Bcrypt Generator</h1>
      <p class="sub">
        Generate salts and hashes, and verify plaintext against a bcrypt hash.
        All client-side.
      </p>

      <div class="grid">
        <div class="card">
          <label for="password">Password / Plaintext</label>
          <textarea
            id="password"
            rows="3"
            placeholder="Enter text to hash"
            spellcheck="false"
          ></textarea>

          <div class="row" style="margin-top: 10px">
            <div>
              <label for="rounds">Cost (rounds, 4–15 typical)</label>
              <input type="number" id="rounds" min="4" max="15" value="12" />
            </div>
            <div>
              <label for="salt">Salt (optional)</label>
              <input
                type="text"
                id="salt"
                placeholder="Auto-generate if empty"
              />
            </div>
          </div>

          <div class="row" style="margin-top: 8px">
            <button id="genSalt">Generate Salt</button>
            <button id="hash" class="primary">Hash Password</button>
          </div>

          <hr />

          <div class="kv">
            <div class="kv-row">
              <div class="dim">Salt</div>
              <div id="outSalt" class="mono code">—</div>
              <button id="copySalt">Copy</button>
            </div>
            <div class="kv-row">
              <div class="dim">Hash</div>
              <div id="outHash" class="mono code">—</div>
              <button id="copyHash">Copy</button>
            </div>
          </div>

          <div id="status" class="helper" style="margin-top: 8px"></div>
        </div>

        <div class="card">
          <label for="verifyHash">Verify Existing Hash</label>
          <input id="verifyHash" type="text" placeholder="$2b$12$..." />
          <div class="row" style="margin-top: 8px">
            <button id="verify">Verify</button>
            <div class="inline" style="justify-content: flex-end">
              <span class="badge">Result</span>
              <span id="verifyResult" class="mono">—</span>
            </div>
          </div>
          <div class="helper">
            Paste a bcrypt hash (prefix $2b$, $2a$, or $2y$).
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // code in here should not be indented at the first level

      // Lightweight bcryptjs from CDN (UMD) – no build step, client-only usage
      // Note: We load synchronously to keep the tool simple and offline-friendly when cached.
      const script = document.createElement("script");
      script.src = "https://unpkg.com/bcryptjs@2.4.3/dist/bcrypt.min.js";
      document.head.appendChild(script);

      const el = (id) => document.getElementById(id);
      const passwordEl = el("password");
      const roundsEl = el("rounds");
      const saltEl = el("salt");
      const genSaltBtn = el("genSalt");
      const hashBtn = el("hash");
      const outSaltEl = el("outSalt");
      const outHashEl = el("outHash");
      const copySaltBtn = el("copySalt");
      const copyHashBtn = el("copyHash");
      const statusEl = el("status");
      const verifyHashEl = el("verifyHash");
      const verifyBtn = el("verify");
      const verifyResultEl = el("verifyResult");

      function setStatus(msg, ok = true) {
        statusEl.textContent = msg || "";
        statusEl.className = "helper " + (ok ? "ok" : "warn");
      }

      function ensureBcrypt() {
        // @ts-ignore - bcrypt is provided by UMD script
        const bc = window.bcrypt || window.dcodeIO?.bcrypt || window.bcryptjs;
        if (!bc)
          throw new Error("bcrypt not loaded yet. Please wait a moment.");
        return bc;
      }

      async function generateSalt() {
        try {
          const rounds = Math.min(
            15,
            Math.max(4, parseInt(roundsEl.value || "12", 10))
          );
          const bcrypt = ensureBcrypt();
          // bcryptjs salt generation is synchronous; wrap in Promise to keep API uniform
          const salt = await Promise.resolve(bcrypt.genSaltSync(rounds));
          saltEl.value = salt;
          outSaltEl.textContent = salt;
          setStatus("Generated new salt", true);
          return salt;
        } catch (e) {
          setStatus(e.message || "Failed generating salt", false);
          return null;
        }
      }

      async function hashPassword() {
        try {
          const bcrypt = ensureBcrypt();
          const plaintext = passwordEl.value ?? "";
          if (!plaintext) {
            setStatus("Enter text to hash", false);
            return;
          }
          let salt = (saltEl.value || "").trim();
          if (!salt) salt = (await generateSalt()) || "";
          if (!salt) return;
          const hash = await Promise.resolve(bcrypt.hashSync(plaintext, salt));
          outHashEl.textContent = hash;
          setStatus("Hashed successfully", true);
        } catch (e) {
          setStatus(e.message || "Hashing failed", false);
        }
      }

      async function verifyPassword() {
        try {
          const bcrypt = ensureBcrypt();
          const plaintext = passwordEl.value ?? "";
          const hash = verifyHashEl.value ?? "";
          if (!plaintext || !hash) {
            verifyResultEl.textContent = "Provide plaintext and hash";
            verifyResultEl.className = "mono warn";
            return;
          }
          const ok = await Promise.resolve(bcrypt.compareSync(plaintext, hash));
          verifyResultEl.textContent = ok ? "MATCH" : "NO MATCH";
          verifyResultEl.className = "mono " + (ok ? "ok" : "warn");
        } catch (e) {
          verifyResultEl.textContent = e.message || "Verification error";
          verifyResultEl.className = "mono warn";
        }
      }

      async function copyText(getter) {
        try {
          const text = getter();
          if (!text || text === "—") throw new Error("Nothing to copy");
          await navigator.clipboard.writeText(text);
          setStatus("Copied to clipboard", true);
        } catch (e) {
          setStatus(e.message || "Copy failed", false);
        }
      }

      genSaltBtn.addEventListener("click", generateSalt);
      hashBtn.addEventListener("click", hashPassword);
      verifyBtn.addEventListener("click", verifyPassword);
      copySaltBtn.addEventListener("click", () =>
        copyText(() => outSaltEl.textContent)
      );
      copyHashBtn.addEventListener("click", () =>
        copyText(() => outHashEl.textContent)
      );
    </script>
  </body>
</html>
