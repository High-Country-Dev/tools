<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>URL Encode / Decode</title>
    <style>
      * {
        box-sizing: border-box;
      }
      :root {
        --bg: #0e0f11;
        --panel: #16181c;
        --ink: #e9ecf1;
        --muted: #9aa5b1;
        --accent: #4cc9f0;
        --ok: #22c55e;
        --warn: #f59e0b;
        --radius: 14px;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
          Helvetica, Arial, "Segoe UI", Roboto, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        background: linear-gradient(180deg, #0b0c0e, var(--bg));
        color: var(--ink);
        display: grid;
        place-items: center;
        padding: 24px;
      }
      .container {
        width: 100%;
        max-width: 900px;
        background: var(--panel);
        border: 1px solid #23262d;
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }
      h1 {
        margin: 0 0 6px;
        font-size: 22px;
        font-weight: 700;
      }
      p.sub {
        margin: 0 0 14px;
        color: var(--muted);
        font-size: 14px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 820px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .card {
        background: #111317;
        border: 1px solid #22252c;
        border-radius: 12px;
        padding: 14px;
      }
      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input,
      select,
      textarea,
      button {
        width: 100%;
        font-size: 16px;
        font-family: Helvetica, Arial, sans-serif;
      }
      textarea,
      input[type="text"],
      select {
        background: #0f1115;
        color: var(--ink);
        border: 1px solid #2a2e36;
        border-radius: 10px;
        padding: 10px 12px;
        outline: none;
      }
      textarea:focus,
      input[type="text"]:focus,
      select:focus {
        border-color: var(--accent);
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      button {
        background: linear-gradient(180deg, #1c2027, #15181d);
        color: var(--ink);
        border: 1px solid #262a32;
        border-radius: 10px;
        padding: 10px 12px;
        cursor: pointer;
      }
      button:hover {
        border-color: var(--accent);
      }
      .helper {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }
      hr {
        border: none;
        border-top: 1px solid #242831;
        margin: 12px 0;
      }
      .inline {
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
      .titleRow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .btn-sm {
        width: auto;
        padding: 6px 10px;
        font-size: 14px;
      }
      .io-grid {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 10px;
        align-items: stretch;
      }
      @media (max-width: 820px) {
        .io-grid {
          grid-template-columns: 1fr;
        }
      }
      .vstack {
        display: grid;
        grid-auto-rows: min-content;
        gap: 8px;
        align-content: center;
        justify-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>URL Encode / Decode</h1>
      <p class="sub">
        Convert strings using encodeURIComponent/decodeURIComponent with helpers
        for full URLs and query strings.
      </p>
      <div class="grid">
        <div class="card">
          <div class="row" style="margin-top: 0">
            <div>
              <label for="mode">Mode</label>
              <select id="mode">
                <option value="component" selected>
                  Component (encodeURIComponent)
                </option>
                <option value="fullurl">
                  Full URL (encode only query/fragment)
                </option>
                <option value="query">Query String (key=value&...)</option>
              </select>
            </div>
            <div>
              <label for="space">Space handling</label>
              <select id="space">
                <option value="percent" selected>%20</option>
                <option value="plus">+</option>
              </select>
            </div>
          </div>

          <hr />

          <div class="io-grid">
            <div>
              <div class="titleRow">
                <label for="decoded">Decoded text</label>
                <button id="copyDecoded" class="btn-sm" title="Copy decoded">
                  Copy
                </button>
              </div>
              <textarea
                id="decoded"
                rows="8"
                placeholder="Paste decoded text here (e.g., normal string or URL)"
              ></textarea>
            </div>
            <div class="vstack" aria-hidden="false">
              <button id="encode" title="Encode decoded → encoded">
                Encode →
              </button>
              <button id="decode" title="Decode encoded → decoded">
                ← Decode
              </button>
            </div>
            <div>
              <div class="titleRow">
                <label for="encoded">Encoded text</label>
                <button id="copyEncoded" class="btn-sm" title="Copy encoded">
                  Copy
                </button>
              </div>
              <textarea
                id="encoded"
                rows="8"
                class="mono"
                placeholder="Paste encoded text here (e.g., % encoded or + spaces)"
              ></textarea>
            </div>
          </div>

          <div id="status" class="helper" style="margin-top: 8px"></div>
        </div>

        <div class="card">
          <label for="kvInput">Query Builder</label>
          <textarea
            id="kvInput"
            rows="8"
            placeholder="key=value\nfoo=bar"
          ></textarea>
          <div class="row" style="margin-top: 8px">
            <button id="toQuery">Build Query</button>
            <button id="parseQuery">Parse Query</button>
          </div>
          <hr />
          <label for="kvOutput">Result</label>
          <textarea
            id="kvOutput"
            rows="8"
            class="mono"
            spellcheck="false"
            readonly
          ></textarea>
        </div>
      </div>
    </div>

    <script type="module">
      // code in here should not be indented at the first level

      const el = (id) => document.getElementById(id);
      const decodedEl = el("decoded");
      const encodedEl = el("encoded");
      const modeEl = el("mode");
      const spaceEl = el("space");
      const encodeBtn = el("encode");
      const decodeBtn = el("decode");
      const copyDecodedBtn = el("copyDecoded");
      const copyEncodedBtn = el("copyEncoded");
      const statusEl = el("status");
      const kvInputEl = el("kvInput");
      const toQueryBtn = el("toQuery");
      const parseQueryBtn = el("parseQuery");
      const kvOutputEl = el("kvOutput");

      function setStatus(msg, ok = true) {
        statusEl.textContent = msg || "";
        statusEl.className = "helper " + (ok ? "ok" : "warn");
      }

      function encodeComponent(s) {
        const encoded = encodeURIComponent(s);
        if (spaceEl.value === "plus") return encoded.replace(/%20/g, "+");
        return encoded;
      }
      function decodeComponent(s) {
        const normalized =
          spaceEl.value === "plus" ? s.replace(/\+/g, "%20") : s;
        return decodeURIComponent(normalized);
      }

      function encodeFullUrl(url) {
        try {
          const u = new URL(url);
          // Re-encode each query param
          const params = new URLSearchParams(u.search);
          const next = new URL(u.origin + u.pathname);
          params.forEach((v, k) => next.searchParams.append(k, v));
          next.hash = u.hash ? "#" + encodeComponent(u.hash.slice(1)) : "";
          return next.toString();
        } catch {
          // Not a full URL; fall back to component mode
          return encodeComponent(url);
        }
      }

      function buildQueryFromLines(lines) {
        const qp = new URLSearchParams();
        lines.forEach((line) => {
          const t = line.trim();
          if (!t) return;
          const idx = t.indexOf("=");
          const key = idx >= 0 ? t.slice(0, idx) : t;
          const val = idx >= 0 ? t.slice(idx + 1) : "";
          qp.append(key, val);
        });
        return qp.toString();
      }

      function parseQueryToLines(qs) {
        const params = new URLSearchParams(
          qs.startsWith("?") ? qs.slice(1) : qs
        );
        const out = [];
        params.forEach((v, k) => out.push(k + "=" + v));
        return out.join("\n");
      }

      function onEncode() {
        const v = decodedEl.value || "";
        if (!v) {
          encodedEl.value = "";
          return setStatus("", true);
        }
        let out = "";
        switch (modeEl.value) {
          case "component":
            out = encodeComponent(v);
            break;
          case "fullurl":
            out = encodeFullUrl(v);
            break;
          case "query":
            out = buildQueryFromLines(v.split(/\r?\n/));
            break;
        }
        encodedEl.value = out;
        setStatus("Encoded", true);
      }

      function onDecode() {
        const v = encodedEl.value || "";
        if (!v) {
          decodedEl.value = "";
          return setStatus("", true);
        }
        let out = "";
        switch (modeEl.value) {
          case "component":
            out = decodeComponent(v);
            break;
          case "fullurl":
            try {
              const u = new URL(v);
              const params = new URLSearchParams(u.search);
              const decodedPairs = [];
              params.forEach((val, key) => decodedPairs.push(key + "=" + val));
              out = [
                u.origin + u.pathname,
                decodedPairs.length ? "?" + decodedPairs.join("&") : "",
                u.hash,
              ].join("");
            } catch {
              out = decodeComponent(v);
            }
            break;
          case "query":
            out = parseQueryToLines(v);
            break;
        }
        decodedEl.value = out;
        setStatus("Decoded", true);
      }

      async function copyTextArea(node) {
        try {
          const t = node.value || "";
          if (!t) throw new Error("Nothing to copy");
          await navigator.clipboard.writeText(t);
          setStatus("Copied", true);
        } catch (e) {
          setStatus(e.message || "Copy failed", false);
        }
      }

      encodeBtn.addEventListener("click", onEncode);
      decodeBtn.addEventListener("click", onDecode);
      copyDecodedBtn.addEventListener("click", () => copyTextArea(decodedEl));
      copyEncodedBtn.addEventListener("click", () => copyTextArea(encodedEl));

      toQueryBtn.addEventListener("click", () => {
        kvOutputEl.value = buildQueryFromLines(
          (kvInputEl.value || "").split(/\r?\n/)
        );
      });
      parseQueryBtn.addEventListener("click", () => {
        kvOutputEl.value = parseQueryToLines(kvInputEl.value || "");
      });
    </script>
  </body>
</html>
